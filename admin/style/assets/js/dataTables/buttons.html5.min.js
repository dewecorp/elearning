/*! Buttons for DataTables 1.6.1
 * Â©2016-2020 SpryMedia Ltd - datatables.net/license
 */

(function( factory ){
	if ( typeof define === 'function' && define.amd ) {
		// AMD
		define( ['jquery', 'datatables.net'], function ( $ ) {
			return factory( $, window, document );
		} );
	}
	else if ( typeof exports === 'object' ) {
		// CommonJS
		module.exports = function (root, $) {
			if ( ! root ) {
				root = window;
			}

			if ( ! $ || ! $.fn.dataTable ) {
				$ = require('datatables.net')(root, $).$;
			}

			return factory( $, root, root.document );
		};
	}
	else {
		// Browser
		factory( jQuery, window, document );
	}
}(function( $, window, document, undefined ) {
'use strict';
var DataTable = $.fn.dataTable;


$.extend( true, DataTable.Buttons.defaults, {
	dom: {
		container: {
			className: 'dt-buttons btn-group flex-wrap'
		},
		button: {
			className: 'btn btn-secondary'
		},
		collection: {
			tag: 'div',
			className: 'dt-button-collection dropdown-menu',
			button: {
				tag: 'a',
				className: 'dt-button dropdown-item',
				active: 'active',
				disabled: 'disabled'
			}
		}
	},
	buttons: [
		{
			extend: 'copy',
			className: 'btn-secondary'
		},
		{
			extend: 'excel',
			className: 'btn-secondary'
		},
		{
			extend: 'csv',
			className: 'btn-secondary'
		},
		{
			extend: 'pdf',
			className: 'btn-secondary'
		},
		{
			extend: 'print',
			className: 'btn-secondary'
		}
	]
} );

DataTable.ext.buttons.copy.title = function ( dt ) {
	return dt.i18n( 'buttons.copyTitle', 'Copy to clipboard' );
};

DataTable.ext.buttons.copy.footer = function ( dt ) {
	return dt.i18n( 'buttons.copySuccess', {
		1: 'Copied one row to clipboard',
		_: 'Copied %d rows to clipboard'
	} );
};

DataTable.ext.buttons.copyHtml5 = {
	className: 'buttons-copy',
	text: function ( dt ) {
		return dt.i18n( 'buttons.copy', 'Copy' );
	},
	action: function ( e, dt, button, config ) {
		var exportData = _exportData( dt, config );
		var output = exportData.str;
		var hiddenDiv = $('<div/>')
			.css( {
				height: 1,
				width: 1,
				overflow: 'hidden',
				position: 'fixed',
				top: 0,
				left: 0
			} );

		if ( config.customize ) {
			output = config.customize( output, config );
		}

		var textarea = $('<textarea readonly/>')
			.val( output )
			.appendTo( hiddenDiv );

		// For browsers that support execCommand, try to use it
		if ( document.queryCommandSupported('copy') ) {
			hiddenDiv.appendTo( dt.table().container() );
			textarea[0].focus();
			textarea[0].select();

			try {
				var successful = document.execCommand( 'copy' );
				hiddenDiv.remove();

				if (successful) {
					dt.buttons.info(
						dt.i18n( 'buttons.copyTitle', 'Copy to clipboard' ),
						dt.i18n( 'buttons.copySuccess', {
							1: 'Copied one row to clipboard',
							_: 'Copied %d rows to clipboard'
						}, exportData.rows ),
						2000
					);
					return;
				}
			}
			catch (t) {}
		}

		// Otherwise we show the text box and instruct the user to use it
		var message = $('<span>'+dt.i18n( 'buttons.copyKeys',
				'Press <i>ctrl</i> or <i>\u2318</i> + <i>C</i> to copy the table data<br>to your system clipboard.<br><br>'+
				'To cancel, click this box or press escape.' )+'</span>'
			)
			.append( hiddenDiv );

		dt.buttons.info( dt.i18n( 'buttons.copyTitle', 'Copy to clipboard' ), message, 0 );

		// Select the text so when the user presses ctrl+c it will be copied
		textarea[0].focus();
		textarea[0].select();

		// Event to close the message box
		$(document)
			.on( 'keydown.DT', function (e) {
				if ( e.keyCode === 27 ) { // esc
					that.close();
				}
			} )
			.one( 'mouseup.DT', function () {
				that.close();
			} );
	},

	exportOptions: {},

	fieldSeparator: '\t',

	fieldBoundary: '',

	header: true,

	footer: false
};


DataTable.ext.buttons.csvHtml5 = {
	bom: false,
	className: 'buttons-csv',
	available: function () {
		return window.FileReader !== undefined && window.Blob;
	},
	text: function ( dt ) {
		return dt.i18n( 'buttons.csv', 'CSV' );
	},
	action: function ( e, dt, button, config ) {
		var output = _exportData( dt, config ).str;
		var charset = config.charset;

		if ( config.customize ) {
			output = config.customize( output, config );
		}

		if ( charset !== false ) {
			if ( ! charset ) {
				charset = document.characterSet || document.charset;
			}

			if ( charset ) {
				charset = ';charset='+charset;
			}
		}
		else {
			charset = '';
		}

		_saveAs(
			new Blob( [output], {type: 'text/csv'+charset} ),
			_filename( config ),
			true
		);
	},

	filename: '*',

	extension: '.csv',

	exportOptions: {},

	fieldSeparator: ',',

	fieldBoundary: '"',

	escapeChar: '"',

	charset: null,

	header: true,

	footer: false
};


DataTable.ext.buttons.excelHtml5 = {
	className: 'buttons-excel',
	available: function () {
		return window.FileReader !== undefined && window.Blob;
	},
	text: function ( dt ) {
		return dt.i18n( 'buttons.excel', 'Excel' );
	},
	action: function ( e, dt, button, config ) {
		var rowPos = 0;
		var getXml = function ( type ) {
			var str = excelStrings[ type ];

			//str = str.replace( /xmlns:/g, 'xmlns_' ).replace( /mc:/g, 'mc_' );

			return $.parseXML( str );
		};
		var genRow = function ( row, updateRow ) {
			var insert = '';
			var i = 0;

			for ( i=0 ; i<row.length ; i++ ) {
				if ( row[i] === null || row[i] === undefined ) {
					row[i] = '';
				}

				insert += '<c t="inlineStr" r="'+createCellPos(i)+(updateRow || '')+'">';
				insert += '<is><t>'+$.fn.dataTable.Buttons.stripData( row[i], config )+'</t></is>';
				insert += '</c>';
			}

			return insert;
		};
		var addRow = function ( row, inInfo ) {
			var d = getXml('row');
			var i, att, val;

			for ( i=0 ; i<row.length ; i++ ) {
				d.getElementsByTagName('row')[0].appendChild( genRow( [row[i]], rowPos+1 ) );
			}

			rowPos++;
		};
		var rels = getXml('xl/worksheets/sheet1.xml');
		var relsGet = rels.getElementsByTagName('sheetData')[0];

		var xlsx = {
			_rels: {
				".rels": $.parseXML( excelStrings['_rels']['.rels'] )
			},
			xl: {
				_rels: {
					"workbook.xml.rels": $.parseXML( excelStrings['xl/_rels/workbook.xml.rels'] )
				},
				"workbook.xml": getXml('xl/workbook.xml'),
				"styles.xml": getXml('xl/styles.xml'),
				"worksheets": {
					"sheet1.xml": rels
				}

			},
			"[Content_Types].xml": getXml('[Content_Types].xml')
		};

		var data = dt.buttons.exportData( config.exportOptions );
		var currentRow, rowNode;
		var addRowSpan = function ( row, maxR ) {
			for ( var i=0 ; i<row.length ; i++ ) {
				if ( row[i].rowspan && row[i].rowspan > 1 ) {
					var tag = 'rowSpan="'+row[i].rowspan+'"';
					var x = createCellPos( i );
					var d = $.parseXML( '<mergeCells xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main">'+tag+'</mergeCells>' );
					d.getElementsByTagName('mergeCell')[0].setAttribute( 'ref', x+rowPos+':'+x+(rowPos+parseInt(row[i].rowspan)-1) );
					rowNode.appendChild( d.getElementsByTagName('mergeCell')[0] );
					maxR = rowPos+parseInt(row[i].rowspan)-1;
				}
			}

			return maxR;
		};

		for ( var n=0 ; n<data.body.length ; n++ ) {
			currentRow = [];
			rowNode = relsGet.appendChild( rels.createElement( "row" ) );
			rowNode.setAttribute( "r", rowPos+1 );
			for ( var i=0 ; i<data.body[n].length ; i++ ) {
				currentRow.push( {
					cell: data.body[n][i],
					enabled: true
				} );
			}

			// Add the cells to the spreadsheet
			for ( var j=0 ; j<currentRow.length ; j++ ) {
				if ( currentRow[j].enabled ) {
					rowNode.appendChild( genRow( [currentRow[j].cell], rowPos+1 ) );
				}
			}
			rowPos++;
		}

		// Set the column widths
		var cols = getXml('xl/worksheets/sheet1.xml');
		var colEl = cols.createElement('cols');
		$('worksheet', cols).prepend( colEl );

		for ( i=0 ; i<data.header.length ; i++ ) {
			var col = cols.createElement('col');
			col.setAttribute('min', i+1);
			col.setAttribute('max', i+1);
			
			// Calculate the width based on the content
			var maxWidth = 5;
			for ( var r=0 ; r<data.body.length ; r++ ) {
				if ( data.body[r][i] && data.body[r][i].toString().length > maxWidth ) {
					maxWidth = data.body[r][i].toString().length;
				}
			}
			if ( data.header[i] && data.header[i].toString().length > maxWidth ) {
				maxWidth = data.header[i].toString().length;
			}
			if ( maxWidth > 50 ) maxWidth = 50;
			
			col.setAttribute('width', maxWidth < 8 ? 8 : maxWidth);
			colEl.appendChild( col );
		}

		// Let the developer customise the document if they want to
		if ( config.customize ) {
			config.customize( xlsx, config, dt );
		}

		_saveAs(
			new Blob( [ _formatExcel( xlsx ) ], {type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'} ),
			_filename( config ),
			true
		);
	},

	filename: '*',

	extension: '.xlsx',

	exportOptions: {},

	header: true,

	footer: false
};


DataTable.ext.buttons.pdfHtml5 = {
	className: 'buttons-pdf',
	available: function () {
		return window.FileReader !== undefined && window.jsPDF && window.jsPDF.version;
	},
	text: function ( dt ) {
		return dt.i18n( 'buttons.pdf', 'PDF' );
	},
	action: function ( e, dt, button, config ) {
		var newLine = '\n';
		var data = dt.buttons.exportData( config.exportOptions );
		var totalWidth = dt.table().container().offsetWidth;

		// Calculate the column width ratios for printing
		var ratios = dt.columns( config.columns ).indexes().map( function ( idx ) {
			return dt.column( idx ).header().offsetWidth / totalWidth;
		} );

		var doc = new window.jsPDF( 'landscape', 'pt', 'a4' );
		var margins = 20;
		var width = doc.internal.pageSize.width - (2 * margins);

		doc.setFontSize( 16 );
		doc.text( config.title || dt.i18n( 'buttons.print', 'Print' ), margins, 30 );

		doc.setFontSize( 10 );
		doc.setTextColor( 80 );
		doc.setFontStyle( 'normal' );
		
		if ( config.messageTop ) {
			doc.text( config.messageTop, margins, 45 );
		}

		// Calculate column widths based on ratios
		var colWidths = [];
		var currentX = margins;
		for ( var i=0 ; i<ratios.length ; i++ ) {
			colWidths.push( width * ratios[i] );
		}

		// Draw the headers
		var yPos = 60;
		for ( var i=0 ; i<data.header.length ; i++ ) {
			doc.setFillColor( 200 );
			doc.rect( currentX, yPos, colWidths[i], 20, 'F' );
			doc.setFillColor( 255 );
			doc.text( data.header[i], currentX + 5, yPos + 14 );
			currentX += colWidths[i];
		}

		// Draw the data rows
		yPos += 20;
		for ( var row=0 ; row<data.body.length ; row++ ) {
			currentX = margins;
			for ( var col=0 ; col<data.body[row].length ; col++ ) {
				doc.rect( currentX, yPos, colWidths[col], 20 );
				doc.text( data.body[row][col], currentX + 5, yPos + 14 );
				currentX += colWidths[col];
			}
			yPos += 20;
		}

		if ( config.messageBottom ) {
			doc.text( config.messageBottom, margins, yPos + 10 );
		}

		// Add footer
		var totalPages = doc.getNumberOfPages();
		for (var i = 1; i <= totalPages; i++) {
			doc.setPage(i);
			doc.text(i + ' / ' + totalPages, doc.internal.pageSize.width - margins - 30, doc.internal.pageSize.height - 10);
		}

		if ( config.customize ) {
			config.customize( doc, config, dt );
		}

		doc.save( _filename( config ) );
	},

	title: '*',

	filename: '*',

	extension: '.pdf',

	exportOptions: {},

	messageTop: '*',

	messageBottom: '*',

	header: true,

	footer: false
};


DataTable.ext.buttons.print = {
	className: 'buttons-print',
	text: function ( dt ) {
		return dt.i18n( 'buttons.print', 'Print' );
	},
	action: function ( e, dt, button, config ) {
		var popup = config.messageTop;
		var fullMessage = popup + '<table>' +
			'<thead>' +
				'<tr>';
		
		var data = dt.buttons.exportData( config.exportOptions );
		var header = data.header;
		for ( var i=0 ; i<header.length ; i++ ) {
			fullMessage += '<th>' + header[i] + '</th>';
		}
		fullMessage += '</tr></thead><tbody>';
		
		for ( var i=0 ; i<data.body.length ; i++ ) {
			fullMessage += '<tr>';
			for ( var j=0 ; j<data.body[i].length ; j++ ) {
				fullMessage += '<td>' + data.body[i][j] + '</td>';
			}
			fullMessage += '</tr>';
		}
		fullMessage += '</tbody></table>' + config.messageBottom;
		
		// Open a new window with the data
		var win = window.open( '', '' );
		win.document.close();
		
		var doc = win.document;
		doc.open();
		doc.write( '<html><head><title>' + config.title + '</title>' +
			'<style>' +
				'table { border-collapse: collapse; width: 100%; }' +
				'th, td { border: 1px solid #ddd; padding: 8px; }' +
				'th { background-color: #f2f2f2; }' +
			'</style>' +
		'</head><body>' + fullMessage + '</body></html>' );
		doc.close();

		// Print the window
		win.focus();
		win.print();
		win.close();
	},

	title: '*',

	messageTop: '*',

	messageBottom: '*',

	exportOptions: {},

	header: true,

	footer: false
};


/* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
 * DataTables interface
 */

// Attach to DataTables objects for global access
$.fn.dataTable.Buttons = DataTable.Buttons;
$.fn.dataTable.ExportButtons = DataTable.Buttons;

// DataTables creation - check if the buttons have been defined for this table,
// they will have been if the `B` option was used in `dom`, otherwise we should
// create the buttons instance here so they can be inserted into the document
// using the API. Listen for `init` for compatibility with pre 1.10.10, but to
// be removed 2.0 (